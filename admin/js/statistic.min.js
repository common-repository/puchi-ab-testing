!function(t){"use strict";window.puchi={el:{window:t(window),document:t(document)},def:{chartColor:{0:{color:"rgba(33, 150, 243, 1)",oColor:"rgba(33, 150, 243, 0.5)"},1:{color:"rgba(82, 185, 71, 1)",oColor:"rgba(82, 185, 71, 0.5)"},2:{color:"rgba(239, 83, 80, 1)",oColor:"rgba(239, 83, 80, 0.5)"},3:{color:"rgba(121, 85, 72, 1)",oColor:"rgba(121, 85, 72, 0.5)"},4:{color:"rgba(103, 58, 183, 1)",oColor:"rgba(103, 58, 183, 0.5)"}},pchChart:"",pchChartData:""},fn:{puchiConfirm:function(e){t.confirm({title:e.title,animateFromElement:!1,content:e.content,buttons:{confirm:{btnClass:"button button-primary",action:e.action},cancel:{btnClass:"button"}},backgroundDismiss:!0})},puchiAlert:function(e){t.alert({title:e.title,content:e.content,animateFromElement:!1,buttons:{close:{btnClass:"btn-hidden",action:function(){}}},autoClose:"close|100",backgroundDismiss:!0})},puchiGenerateTbl:function(){t(".pch-tbl").each(function(){var e=t(this).data("table"),a={pagingType:"full_numbers",language:{paginate:{last:"&#187;",first:"&#171;",next:"&#155;",previous:"&#139;"}},order:[[1,"desc"]]};if(void 0!==e&&"object"==typeof e&&null!==e)for(var c in e)e.hasOwnProperty(c)&&(a[c]=e[c]);t(this).find("table").DataTable(a),t('<div class="clear"></div>').insertBefore(t(this).find("table")),t('<div class="clear"></div>').appendTo(t(this).find(" > *:first-child"))})},puchiFetchTable:function(e,a){t.post(puchi_data.api_url+"get_range_statistic_data/",{type:e.type,page:e.page,split:e.split,content:e.content},function(t){a.html(t.content),a.removeClass("fetching")})},puchiDrawChart:function(e){const a=e.label;var c=[],i=0;t.each(e.split,function(t,a){c.push({label:a.label,data:a.data[e.type],borderColor:puchi.def.chartColor[i].color,backgroundColor:puchi.def.chartColor[i].oColor}),i++});var n={type:"line",data:{labels:a,datasets:c},options:{responsive:!0,legend:{display:!0,position:"bottom"},hover:{mode:"index"},tooltips:{}}};""!=puchi.def.pchChart&&puchi.def.pchChart.destroy(),setTimeout(function(){var e=document.getElementById("pch-chart").getContext("2d");puchi.def.pchChart=new Chart(e,n),t(".pch-chart-widget .pch-widget-body").removeClass("fetching")},100)},puchiFetchChartData:function(e,a,c,i,n){t.post(puchi_data.api_url+"get_chart_statistic_data/",{page:e,split:a,range:c,custom:i},function(e){"ok"==e.status?(puchi.def.pchChartData=e,puchi.def.pchChartData.type=n,puchi.fn.puchiDrawChart(puchi.def.pchChartData)):(""!=puchi.def.pchChart&&puchi.def.pchChart.destroy(),t(".pch-chart-widget .pch-widget-body").removeClass("fetching"),puchi.def.pchChartData="")})},puchiFetchTableData:function(e,a,c,i){t.post(puchi_data.api_url+"get_table_statistic_data/",{page:e,split:a,range:c,custom:i},function(e){if("ok"==e.status){var a=t("#pch-stat-content-tbl table");a.hasClass("dataTable")&&a.dataTable().fnDestroy(),t("#pch-stat-content-tbl table tbody").html(e.content),puchi.fn.puchiGenerateTbl()}})}},run:function(){puchi.el.window.load(function(){if(t("#pch-chart").length){t(".pch-datepicker").datepicker({dateFormat:"yy-mm-dd"});var e=t('input[name="from"].pch-datepicker').first(),a=t('input[name="to"].pch-datepicker').first();e.on("change",function(){var e=t(this).datepicker("getDate");a.datepicker("option","disabled",!1),e.setDate(e.getDate()+1),a.datepicker("option","minDate",e)}),a.datepicker("option","minDate",new Date),a.datepicker("option","maxDate",new Date),a.datepicker("option","disabled",!0),e.datepicker("option","maxDate",new Date),t("#ui-datepicker-div *").remove();var c=t(".pch-chart-widget").data("chart"),i=c.page,n=c.split,h=c.range,o=[],l=c.type;puchi.fn.puchiFetchChartData(i,n,h,o,l),t(".pch-chart-type .dropholder a").click(function(e){if(e.preventDefault(),!t(this).closest("li").hasClass("active")){var a=t(this),c=a.closest(".pch-chart-widget"),i=c.find(".pch-widget-head").find("h2");c.find(".pch-chart-type > span b").html(a.text()),t(".pch-chart-type .dropholder li").removeClass("active"),a.closest("li").addClass("active"),i.html(a.text()),l=a.attr("data-stat"),puchi.def.pchChartData.type=a.attr("data-stat"),puchi.fn.puchiDrawChart(puchi.def.pchChartData)}}),t(".pch-chart-range .dropholder a").click(function(e){if(e.preventDefault(),!t(this).closest("li").hasClass("active")){var a=t(this),c=a.closest(".pch-range-select");c.hasClass("fetching")||("custom"!=(h=a.attr("data-range"))?(c.find(".custom-range").removeClass("displayed"),c.addClass("fetching"),puchi.fn.puchiFetchChartData(i,n,h,o,l),puchi.fn.puchiFetchTableData(i,n,h,o),c.removeClass("fetching")):(c.find(".custom-range").addClass("displayed"),o.length>1&&(c.addClass("fetching"),puchi.fn.puchiFetchChartData(i,n,h,o,l),puchi.fn.puchiFetchTableData(i,n,h,o),c.removeClass("fetching"))),t(".pch-chart-range .dropholder li").removeClass("active"),c.find(".pch-chart-range > span b").html(a.text()),a.closest("li").addClass("active"))}}),t('.pch-range-select .custom-range input[name="from"]').change(function(){var e=t(this).val();o[0]=e,o.length>1&&(puchi.fn.puchiFetchChartData(i,n,h,o,l),puchi.fn.puchiFetchTableData(i,n,h,o))}),t('.pch-range-select .custom-range input[name="to"]').change(function(){var e=t(this).val();o[1]=e,o.length>1&&(puchi.fn.puchiFetchChartData(i,n,h,o,l),puchi.fn.puchiFetchTableData(i,n,h,o))}),t("#pch-stat-content-tbl").length&&puchi.fn.puchiFetchTableData(i,n,h,o)}}),puchi.el.document.ready(function(){if(t("#pch-stat-page-tbl").length&&(t.get(puchi_data.api_url+"get_page_statistic_data/",function(e){t("#pch-stat-page-tbl table tbody").html(e.content),"ok"==e.status&&puchi.fn.puchiGenerateTbl()}),t(document).on("click",".pch-tbl .action .delete",function(e){e.preventDefault();var a=t(this),c=a.closest("tr"),i=c.find("td:first-child a").text(),n=a.closest("table"),h={title:puchi_data.lang.confirm,content:puchi_data.lang.s1+" <b>"+i+"</b> "+puchi_data.lang.s2,action:function(){c.fadeOut("fast",function(){t.post(puchi_data.api_url+"delete_page_statistic_data/",{id:c.data("id")}),n.dataTable().fnDestroy(),c.remove(),puchi.fn.puchiGenerateTbl()})}};puchi.fn.puchiConfirm(h)})),t(".pch-range-widget").length){var e=t(".pch-range-widget"),a=e.find(".pch-widget-body"),c=e.data("table");setTimeout(function(){puchi.fn.puchiFetchTable(c,a)},1),t(".pch-stat-type .dropholder a").click(function(e){e.preventDefault();var i=t(this),n=i.closest(".pch-widget-head").find("h2"),h=i.attr("data-stat"),o=i.closest(".pch-dropselect");a.hasClass("fetching")||(a.addClass("fetching"),o.find(".dropholder li").removeClass("active"),o.find("> span b").html(i.text()),i.closest("li").addClass("active"),n.html(i.text()),c.type=h,puchi.fn.puchiFetchTable(c,a))}),t(".pch-split-content .dropholder a").click(function(e){e.preventDefault();var i=t(this),n=i.attr("data-split-content"),h=i.closest(".pch-dropselect");a.hasClass("fetching")||(a.addClass("fetching"),h.find(".dropholder li").removeClass("active"),h.find("> span b").html(i.text()),i.closest("li").addClass("active"),c.content=n,puchi.fn.puchiFetchTable(c,a))})}t(".pch-dropselect .dropholder .split-holder ul").length&&t(".pch-dropselect .dropholder .split-holder ul").scrollBox(),t(".pch-dropselect .dropholder .split-holder input").on("keyup",function(){var e=t(this),a=e.closest(".split-holder").find("ul"),c=e.val(),i=e.closest(".split-holder").find("i");""!=c?(a.find("li").addClass("hidden"),i.removeClass("hidden"),a.find('li[data-filter*="'+c.toLowerCase()+'"]').removeClass("hidden")):(a.find("li").removeClass("hidden"),i.addClass("hidden"))}),t(".pch-dropselect .dropholder .split-holder i").click(function(){var e=t(this),a=e.prev("input");a.val(""),e.addClass("hidden"),a.trigger("keyup")}),t(".pch-setting-item").each(function(){var e=t(this),a=e.find(".btn-save"),c=e.find(".pch-to-save");a.click(function(e){e.preventDefault(),""!=c.val()&&t.post(puchi_data.api_url+"set_settings/",{key:c.attr("data-key"),value:c.val()},function(t){puchi.fn.puchiAlert(t)})})})})}},puchi.run()}(jQuery);